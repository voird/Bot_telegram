import telebot
from telebot import types

TOKEN = '8295881899:AAGZ3IFDRKXMkPo9r814IfcgMmnZBdx0RJs'
ADMIN_ID = 1967263018  # твой Telegram ID

bot = telebot.TeleBot(TOKEN)

# временное хранилище анкет
pending_forms = {}

# стартовое сообщение с кнопками
@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    rules_btn = types.KeyboardButton("Правила")
    blood_btn = types.KeyboardButton("Касты крови")
    form_btn = types.KeyboardButton("✏️ Написать анкету")
    markup.add(rules_btn, blood_btn, form_btn)

    bot.send_message(
        message.chat.id,
        """ㅤㅤㅤㅤㅤДобро пожаловать в  Bureau of Utter Confusion!

ㅤГлавный вход в наш офис. Здесь появляются новенькие, гости и те, кто слишком глуп, чтобы найти правильную дверь.
Через Ресепшен проходят все, кто хочет присоединиться к компании, задать вопрос, пожаловаться, или просто потеряться.
Наши секретари не кусаются… если вы не краснокровка.

ㅤЗдесь проходят приветствия, регистрация, заполнение анкет. Анкеты заполнять только здесь, другие топики не засорять.
ㅤПеред заполнением форм обязательно ознакомьтесь с сюжетом и правилами.""",
        reply_markup=markup
    )

# обработка кнопок стартового меню
@bot.message_handler(func=lambda message: True)
def handle_menu(message):
    if message.text == "Правила":
        bot.send_message(
            message.chat.id,
            """ㅤ«Если ты читаешь это — поздравляем, ты уже совершил ошибку.»

ㅤㅤ1. Общие положения

1.1. Этот офис — учреждение, где тролли делают вид, что работают.
1.2. Все участники обязаны соблюдать корпоративный абсурд, поддерживать RP и уважать иерархию крови (или хотя бы делать вид).
1.3. Незнание правил не освобождает от казни, но добавляет зрелищности.

ㅤㅤ2. Поведение в офисе

2.1. Не превращай офис в арену уничтожения (если только это не утверждённый ивент).
2.2. Пассивная агрессия, сарказм и угрюмое презрение — норма корпоративного общения (или если у вас кисмесис).
2.3. Не перебивай старших по крови (или хотя бы извинись перед тем, как тебя сотрут из архива).
2.4. Оскорбления должны быть вкусно ролевыми, а не скучно реальными.
2.5. Мемы допускаются, если они не глупее, чем тот, кто их скинул.

ㅤㅤ3.  Каноны

3.1. Сюжет развивается в духе Homestuck — корпоративный филиал с отделами, хаосом и бюрократией.
3.2. Персонажи — тролли, офисные мученики, пережившие 9 кофе-перерывов подряд.
3.3. Вне-ролевое обсуждение (OOC) допускается, но отделяется скобками, тегами или хотя бы чувством стыда.
3.4. Канон соблюдается примерно так же строго, как дедлайн — то есть “приблизительно”.

ㅤㅤ4. Запрещено

4.1. Оскорбления игроков (вне RP), травля, и токсичное поведение без контекста ролевки.
4.2. Мета-игра без разрешения.
4.3. Серьёзность. Это Альтернийский офис, не бухгалтерия землян.
4.4. Скука. Если тебе скучно — ты делаешь что-то неправильно.

ㅤㅤ5. Администрация и наказания

5.1. Наказания применяются творчески: от публичного высмеивания до назначения “ответственным за кофемашину”.
5.2. Апелляции подаются в устной форме… в бездну. Или в ЛС администрации.

Здесь уважают хаос, искусство сарказма и умение не сойти с ума.
Добро пожаловать в офис. Подпиши форму, возьми чашку кофе и приготовься умереть от смеха."""
        )
    elif message.text == "Касты крови":
        bot.send_message(
            message.chat.id,
            """ㅤㅤРуководство по иерархии и обязанностям персонала

Организация: Архив Глупых Ошибок и Последующих Казней
Версия документа: 3.13-F
Статус: Обязателен к изучению всеми сотрудниками до конца первой недели адаптации
Гриф: Внутреннее обращение. Нарушение порядка чтения карается повышением.

ㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤВведение

ㅤГемоспектр — это основа стабильности, эффективности и предсказуемости нашей корпорации.
ㅤОн регулирует, кто приносит кофе, кто получает отчёты, а кто утверждает существование Вселенной.
ㅤСледование гемоспектру гарантирует порядок, и, что гораздо важнее, своевременную казнь за его нарушение.

ㅤㅤㅤㅤㅤㅤㅤСТРУКТУРА ОФИСА ПО КАСТАМ

ㅤВсе описанные должности — примерные, можно придумывать свое, но в рамках описанного канона.

ㅤㅤㅤㅤㅤㅤㅤㅤКонфетно-красная кровь

ㅤДолжность: Стажёры, младшие помощники, подопытные.
ㅤСамая низкая каста — вечные новички офиса. Им поручают всё, что никто не хочет делать: сортировать документы, чинить принтеры, носить кофе. Обычно они живут в постоянном страхе и вечной усталости.
ㅤОтдел: Отдел Безнадёжных Инициатив

ㅤㅤㅤㅤㅤㅤㅤㅤБургундская кровь

ㅤДолжность: Младшие клерки, архивариусы, операторы входящих обращений. 
ㅤОни ведут учёт, заполняют формы, сортируют отчёты и спорят с кофемашиной. Редко доживают до отпуска.
ㅤОтдел: Архив документации и жалоб

ㅤㅤㅤㅤㅤㅤㅤㅤБронзовая кровь

ㅤДолжность: Техперсонал, инженеры, механики.
ㅤОни поддерживают здание в относительном рабочем состоянии и чинят всё, что взрывается (а это почти всё). Знают все тайные ходы и слухи.
ㅤОтдел: Техническое обслуживание и поддержка

ㅤㅤㅤㅤㅤㅤㅤㅤЖёлтая кровь

ㅤДолжность: IT-отдел, сисадмины, цифровые некроманты. 
ㅤЗнают язык машин и разговаривают с багами как с живыми существами.Их мониторы видят больше, чем начальство.
ㅤОтдел: Серверная

ㅤㅤㅤㅤㅤㅤㅤㅤЛаймовая кровь

ㅤДолжность: Независимые консультанты, внештатники, “забытые отделом кадров”.
ㅤПо слухам, официально не существуют, но их отчёты всё равно лежат в архиве. Обладают знаниями, которых лучше не иметь.
ㅤОтдел: Секретный департамент решений

ㅤㅤㅤㅤㅤㅤㅤㅤОливковая кровь

ㅤДолжность: Бухгалтеры, аналитики, аудиторы.
ㅤОни сводят отчёты, считают души и кофе.
ㅤОтдел: Финансово-аналитическое бюро

ㅤㅤㅤㅤㅤㅤㅤㅤНефритовая кровь

ㅤДолжность: Медперсонал, HR, отдел кадров и эмоциональной поддержки.
ㅤСледят за состоянием сотрудников, выдают антистресс и увольнения.
ㅤОтдел: Корпоративного здоровья и морального надзора.

ㅤㅤㅤㅤㅤㅤㅤㅤБирюзовая кровь

ㅤДолжность: Юристы, координаторы, менеджеры среднего звена.
ㅤВсегда что-то утверждают, отклоняют или пересогласовывают. Могут убить фразой “не по регламенту”.
ㅤОтдел: Административный контроль и документация

ㅤㅤㅤㅤㅤㅤㅤㅤЛазурная кровь

ㅤДолжность: Охрана, служба внутреннего контроля, инспекторы.
ㅤПатрулируют офис, охраняют двери и дисциплину. Часто устраивают допросы за мемы не по теме.
ㅤОтдел: Внутреннего надзора и корпоративной дисциплины"""
        )
    elif message.text == "✏️ Написать анкету":
        bot.send_message(
            message.chat.id,
            """ㅤВ анкету входит:
1. Имя, никнейм в стиле хс
2. Гемоспектр + профессия, от выбора крови зависит профессия в офисе (Чем выше по кастам - тем солиднее профа). См. топик по описанию РП офиса
3. Характер персонажа, его квирк, как к нему обращаться
4. Необязательный пункт, но можно прикрепить скриншот скина/арт/скрин из популярного мейкера внешнего вида персонажа

Отправь анкету одним сообщением."""
        )
        bot.register_next_step_handler(message, handle_form)

# обработка отправки анкеты
def handle_form(message):
    user_id = message.from_user.id
    pending_forms[user_id] = message.text

    # inline-кнопки для админа
    markup = types.InlineKeyboardMarkup()
    approve_btn = types.InlineKeyboardButton("Подтвердить", callback_data=f"approve_{user_id}")
    reject_btn = types.InlineKeyboardButton("Отклонить", callback_data=f"reject_{user_id}")
    markup.add(approve_btn, reject_btn)

    # отправка админу
    bot.send_message(ADMIN_ID,
                     f"Новая анкета от {message.from_user.first_name}:\n\n{message.text}",
                     reply_markup=markup)
    bot.send_message(message.chat.id, "Анкета отправлена на проверку!")

# обработка кнопок одобрения/отклонения
@bot.callback_query_handler(func=lambda call: True)
def callback_inline(call):
    action, user_id_str = call.data.split("_")
    user_id = int(user_id_str)

    if action == "approve":
        bot.send_message(user_id, "Ваша анкета одобрена! https://t.me/+wTLz-jPwlEQyY2Qy")
        bot.edit_message_text("Анкета одобрена",
                              chat_id=call.message.chat.id,
                              message_id=call.message.message_id)
    elif action == "reject":
        bot.send_message(user_id, "Ваша анкета отклонена.")
        bot.edit_message_text("Анкета отклонена",
                              chat_id=call.message.chat.id,
                              message_id=call.message.message_id)

    pending_forms.pop(user_id, None)

bot.infinity_polling()

